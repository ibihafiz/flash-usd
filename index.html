<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flash USDT Minting Portal</title>
  <style>
    body {
      background-color: #0d1b2a;
      color: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    h1 {
      color: #3498db;
    }
    .card {
      background: #1a2530;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .btn {
      background: #3498db;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn:hover {
      background: #2980b9;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .status {
      margin-top: 15px;
      color: #2ecc71;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Flash USDT Minting Portal</h1>
      <p>Mint USDT tokens with expiration on Tron Nile Testnet</p>
    </header>

    <div class="card">
      <button class="btn" id="connectButton">Connect TronLink Wallet</button>
      <p id="walletAddress">Wallet not connected</p>
    </div>

    <div class="card">
      <label for="amount">Amount to Mint</label>
      <input type="number" id="amount" placeholder="Enter amount (e.g., 100)" min="1">

      <label for="expiry">Expiry Duration (in seconds)</label>
      <input type="number" id="expiry" placeholder="Enter expiry time (e.g., 3600)" min="1">

      <button class="btn" id="mintButton">Mint USDT</button>
      <div class="status" id="status"></div>
    </div>
  </div>

  <script>
    const CONTRACT_ADDRESS = "TEc6bw2FczmF3kJgvM39M98umP18WeU4Ad"; // Example contract
    const CONTRACT_ABI = [
      {
        inputs: [
          { internalType: "address", name: "to", type: "address" },
          { internalType: "uint256", name: "amount", type: "uint256" },
          { internalType: "uint256", name: "expiry", type: "uint256" }
        ],
        name: "mintWithExpiry",
        outputs: [],
        stateMutability: "nonpayable",
        type: "function"
      }
    ];

    let tronWeb;
    let currentAddress;

    async function connectWallet() {
      const button = document.getElementById("connectButton");
      const walletDisplay = document.getElementById("walletAddress");

      if (!window.tronLink) {
        walletDisplay.textContent = "TronLink not found. Please install the extension.";
        return;
      }

      try {
        await window.tronLink.request({ method: 'tron_requestAccounts' });

        for (let i = 0; i < 10; i++) {
          if (window.tronWeb && window.tronWeb.ready && window.tronWeb.defaultAddress.base58) {
            break;
          }
          await new Promise(resolve => setTimeout(resolve, 200));
        }

        if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
          tronWeb = window.tronWeb;
          currentAddress = tronWeb.defaultAddress.base58;
          walletDisplay.textContent = `Connected: ${currentAddress}`;
        } else {
          walletDisplay.textContent = "Failed to connect to TronLink.";
        }
      } catch (err) {
        walletDisplay.textContent = "Connection denied or failed.";
        console.error(err);
      }
    }

    async function mint() {
      const amountInput = document.getElementById("amount").value;
      const expiryInput = document.getElementById("expiry").value;
      const status = document.getElementById("status");

      if (!tronWeb || !currentAddress) {
        status.textContent = "Wallet not connected.";
        return;
      }

      if (!amountInput || !expiryInput) {
        status.textContent = "Please enter both amount and expiry.";
        return;
      }

      try {
        const amount = tronWeb.toBigNumber(amountInput).times(1e6).toString();
        const expiryTimestamp = Math.floor(Date.now() / 1000) + parseInt(expiryInput);

        const contract = await tronWeb.contract(CONTRACT_ABI, CONTRACT_ADDRESS);

        await contract.mintWithExpiry(currentAddress, amount, expiryTimestamp).send({ feeLimit: 100_000_000 });

        status.textContent = "Mint successful! Check your wallet.";
      } catch (err) {
        status.textContent = `Error: ${err.message}`;
        console.error(err);
      }
    }

    document.getElementById("connectButton").addEventListener("click", connectWallet);
    document.getElementById("mintButton").addEventListener("click", mint);
  </script>
</body>
</html>
