<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flash USDT Minting Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- üí° Your existing CSS remains unchanged -->
  <style>
    /* ... your full CSS remains unchanged ... */
  </style>
</head>
<body>
  <div class="container">
    <!-- üí° Your full HTML structure remains unchanged -->
    <!-- Header, Wallet Info, Mint Form, Status Box, Token Info, Instructions, Footer -->
    <!-- ... COPY YOUR HTML FROM ORIGINAL VERSION HERE ... -->
  </div>

  <!-- ‚úÖ Full JS with white-screen fix -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const CONTRACT_ADDRESS = "TEc6bw2FczmF3kJgvM39M98umP18WeU4Ad"; // Nile Testnet
      const NILE_CHAIN_ID = "0xcd8690dc";
      const TOKEN_DECIMALS = 6;

      const CONTRACT_ABI = [
        {
          "inputs": [
            { "internalType": "address", "name": "to", "type": "address" },
            { "internalType": "uint256", "name": "amount", "type": "uint256" },
            { "internalType": "uint256", "name": "expiry", "type": "uint256" }
          ],
          "name": "mintWithExpiry",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        }
      ];

      function updateUI() {
        const walletIndicator = document.getElementById("walletIndicator");
        const networkIndicator = document.getElementById("networkIndicator");
        const connectButton = document.getElementById("connectButton");
        const mintButton = document.getElementById("mintButton");

        if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
          const currentAddress = window.tronWeb.defaultAddress.base58;

          walletIndicator.className = "status-indicator connected";
          document.getElementById("walletAddress").textContent = 
            `Connected: ${currentAddress.substring(0, 6)}...${currentAddress.substring(currentAddress.length - 4)}`;

          if (window.tronWeb.fullNode.host.includes('nile')) {
            networkIndicator.className = "status-indicator connected";
            document.getElementById("networkName").textContent = "Network: Nile Testnet";
            document.getElementById("chainId").textContent = `Chain ID: ${NILE_CHAIN_ID}`;
            mintButton.disabled = false;
            setStatus("‚úÖ Wallet connected to Nile Testnet. Ready to mint fUSDT.", "success");
          } else {
            networkIndicator.className = "status-indicator";
            document.getElementById("networkName").textContent = "Network: Wrong Network";
            document.getElementById("chainId").textContent = "Switch to Nile Testnet";
            mintButton.disabled = true;
            setStatus("‚ö†Ô∏è Please switch to Nile Testnet in TronLink", "warning");
          }

          connectButton.textContent = "Disconnect Wallet";
          connectButton.classList.remove("pulse");
        } else {
          walletIndicator.className = "status-indicator";
          networkIndicator.className = "status-indicator";
          document.getElementById("walletAddress").textContent = "Wallet not connected";
          document.getElementById("networkName").textContent = "Network: Not connected";
          document.getElementById("chainId").textContent = "";
          connectButton.textContent = "Connect TronLink Wallet";
          mintButton.disabled = true;
          setStatus("‚ìò Connect your TronLink wallet to get started", "info");
          connectButton.classList.add("pulse");
        }
      }

      function setStatus(message, type = "info") {
        const statusElement = document.getElementById("status");
        statusElement.innerHTML = `<span>${getStatusIcon(type)}</span> ${message}`;
        statusElement.className = `status-message ${type}`;
      }

      function getStatusIcon(type) {
        switch(type) {
          case "success": return "‚úÖ";
          case "error": return "‚ùå";
          case "warning": return "‚ö†Ô∏è";
          default: return "‚ìò";
        }
      }

      async function connectWallet() {
        try {
          if (window.tronLink) {
            if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
              window.tronWeb = undefined;
              updateUI();
              return;
            }

            setStatus("‚è≥ Connecting to TronLink...", "info");
            await window.tronLink.request({ method: 'tron_requestAccounts' });
            updateUI();
          } else {
            setStatus("‚ùå TronLink not detected. Please install TronLink extension.", "error");
          }
        } catch (e) {
          setStatus(`‚ùå Connection failed: ${e.message}`, "error");
          console.error(e);
        }
      }

      async function mint() {
        if (!window.tronWeb || !window.tronWeb.defaultAddress.base58) {
          setStatus("‚ùå Wallet not connected. Please connect your TronLink wallet first.", "error");
          return;
        }

        const tronWeb = window.tronWeb;
        const currentAddress = tronWeb.defaultAddress.base58;

        const amountInput = document.getElementById("amount").value;
        const expiryInput = document.getElementById("expiry").value;

        if (!amountInput || amountInput <= 0) {
          setStatus("‚ùå Please enter a valid amount (greater than 0)", "error");
          return;
        }

        if (!expiryInput || expiryInput <= 0) {
          setStatus("‚ùå Please enter a valid expiry time (greater than 0)", "error");
          return;
        }

        const amount = tronWeb.toBigNumber(amountInput).times(10 ** TOKEN_DECIMALS).toString();
        const expiry = parseInt(expiryInput);
        const expiryTimestamp = Math.floor(Date.now() / 1000) + expiry;

        try {
          setStatus("‚è≥ Processing transaction... Please confirm in TronLink", "info");

          const contractInstance = await tronWeb.contract(CONTRACT_ABI, CONTRACT_ADDRESS);

          const tx = await contractInstance.mintWithExpiry(
            currentAddress,
            amount,
            expiryTimestamp
          ).send({ feeLimit: 100_000_000 });

          const txLink = `https://nile.tronscan.org/#/transaction/${tx}`;
          setStatus(`‚úÖ Minted successfully! <a href="${txLink}" target="_blank" style="color: #2ecc71;">View Transaction</a>`, "success");

          document.getElementById("amount").value = "";
          document.getElementById("expiry").value = "";

        } catch (err) {
          let errorMsg = "‚ùå Transaction failed: " + err.message;

          if (err.message.includes("denied transaction")) {
            errorMsg = "‚ùå Transaction canceled by user";
          } else if (err.message.includes("insufficient energy")) {
            errorMsg = "‚ùå Insufficient energy. Get test TRX from Nile faucet";
          } else if (err.message.includes("contract not found")) {
            errorMsg = "‚ùå Contract not found. Check contract address";
          } else if (err.message.includes("missing address")) {
            errorMsg = "‚ùå Contract address issue. Please refresh and reconnect";
          }

          setStatus(errorMsg, "error");
          console.error(err);
        }
      }

      updateUI();

      if (window.tronLink && window.tronLink.ready) {
        connectWallet();
      }

      // Expose functions to buttons
      window.connectWallet = connectWallet;
      window.mint = mint;
    });
  </script>
</body>
</html>
