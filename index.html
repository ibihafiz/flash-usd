<!DOCTYPE html>
<html>
<head>
    <title>Flash USDT Portal</title>
</head>
<body>
    <h2>Flash USDT Minting</h2>

    <button onclick="connectWallet()">Connect Wallet</button>
    <p id="walletAddress">Wallet not connected</p>

    <input type="number" id="amount" placeholder="Amount to Mint">
    <input type="number" id="expiry" placeholder="Expiry in seconds">
    <button onclick="mint()">Mint Flash USDT</button>

    <p id="status"></p>

    <script>
        const CONTRACT_ADDRESS = "TVFyaRopHyYZvSL6QYaDZ1ASpG3QZY5NUg"; // deployed on Shasta
        let tronWeb;
        let currentAddress;
        let contract;

        async function connectWallet() {
            if (window.tronLink) {
                try {
                    await window.tronLink.request({ method: 'tron_requestAccounts' });
                    tronWeb = window.tronWeb;
                    currentAddress = tronWeb.defaultAddress.base58;
                    document.getElementById("walletAddress").textContent = "Connected: " + currentAddress;
                    contract = await tronWeb.contract().at(CONTRACT_ADDRESS);
                    document.getElementById("status").textContent = "✅ Wallet connected & contract loaded";
                } catch (err) {
                    document.getElementById("status").textContent = "❌ Error loading contract: " + err.message;
                }
            } else {
                alert("TronLink not detected. Please install or enable it.");
            }
        }

        async function mint() {
            if (!tronWeb || !contract) {
                document.getElementById("status").textContent = "❌ Wallet not connected or contract not loaded.";
                return;
            }

            const amount = document.getElementById("amount").value;
            const expirySeconds = document.getElementById("expiry").value;
            const expiryTimestamp = Math.floor(Date.now() / 1000) + parseInt(expirySeconds);

            try {
                const tx = await contract.mintWithExpiry(currentAddress, amount, expiryTimestamp).send({
                    feeLimit: 100000000
                });
                document.getElementById("status").textContent = "✅ Minted successfully. TX: " + tx;
            } catch (err) {
                document.getElementById("status").textContent = "❌ Transaction failed: " + err.message;
            }
        }
    </script>
</body>
</html>
