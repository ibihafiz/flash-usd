<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flash USDT Minting Portal</title>
</head>
<body>
  <h2>Flash USDT Minting Portal (Mainnet)</h2>

  <button onclick="connectWallet()">Connect Wallet</button>
  <p id="walletAddress">Wallet not connected</p>

  <input type="number" id="amount" placeholder="Amount to Mint">
  <input type="number" id="expiry" placeholder="Expiry (in seconds)">
  <button onclick="mint()">Mint Flash USDT</button>

  <p id="status"></p>

  <script>
    const CONTRACT_ADDRESS = "TMAJLJwYBQczCRee3Nn4QDLSEHcBg4zXkY"; // Verified Flash USDT on Mainnet

    let tronWeb;
    let currentAddress;
    let contract;

    async function connectWallet() {
      try {
        if (window.tronWeb && window.tronWeb.ready) {
          tronWeb = window.tronWeb;
          currentAddress = tronWeb.defaultAddress.base58;
          document.getElementById("walletAddress").textContent = "Connected: " + currentAddress;

          contract = await tronWeb.contract().at(CONTRACT_ADDRESS);
          document.getElementById("status").textContent = "✅ Wallet connected & contract loaded";
        } else {
          alert("Please install TronLink and make sure it's unlocked and connected to TRON Mainnet.");
        }
      } catch (e) {
        document.getElementById("status").textContent = "❌ Failed to load contract: " + e.message;
      }
    }

    async function mint() {
      if (!tronWeb || !contract) {
        document.getElementById("status").textContent = "❌ Wallet not connected or contract not loaded.";
        return;
      }

      const amount = parseInt(document.getElementById("amount").value);
      const expirySeconds = parseInt(document.getElementById("expiry").value);

      if (isNaN(amount) || isNaN(expirySeconds)) {
        document.getElementById("status").textContent = "❌ Enter valid amount and expiry.";
        return;
      }

      const expiryTimestamp = Math.floor(Date.now() / 1000) + expirySeconds;

      try {
        const tx = await contract.mintWithExpiry(currentAddress, amount, expiryTimestamp).send({
          feeLimit: 100000000
        });
        document.getElementById("status").textContent = "✅ Minted successfully! TX: " + tx;
      } catch (err) {
        document.getElementById("status").textContent = "❌ Transaction failed: " + err.message;
      }
    }
  </script>
</body>
</html>
